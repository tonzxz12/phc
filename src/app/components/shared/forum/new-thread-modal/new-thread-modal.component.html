<div class="modal fade" #newThreadModal id="newThreadModal" tabindex="-1" role="dialog" aria-labelledby="newThreadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="newThreadModalLabel">
          <i class="fas fa-plus-circle"></i>
          Create New Thread
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      
      <form [formGroup]="threadForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="course-info-banner">
            <i class="fas fa-graduation-cap"></i>
            <span>{{ selectedClass?.course_title || 'Course Forum' }}</span>
          </div>

          <div class="form-group">
            <label for="threadTitle">Thread Title *</label>
            <input
              type="text"
              id="threadTitle"
              class="form-control"
              formControlName="title"
              placeholder="Enter a descriptive title for your thread"
              [class.is-invalid]="threadForm.get('title')?.invalid && threadForm.get('title')?.touched"
            >
            <div class="invalid-feedback" *ngIf="threadForm.get('title')?.invalid && threadForm.get('title')?.touched">
              <small *ngIf="threadForm.get('title')?.errors?.['required']">Title is required</small>
              <small *ngIf="threadForm.get('title')?.errors?.['minlength']">Title must be at least 5 characters long</small>
              <small *ngIf="threadForm.get('title')?.errors?.['maxlength']">Title cannot exceed 200 characters</small>
            </div>
          </div>

          <div class="form-group">
            <label for="threadBody">Thread Content *</label>
            <textarea
              id="threadBody"
              class="form-control"
              formControlName="body"
              rows="6"
              placeholder="Write your thread content here..."
              [class.is-invalid]="threadForm.get('body')?.invalid && threadForm.get('body')?.touched"
            ></textarea>
            <div class="invalid-feedback" *ngIf="threadForm.get('body')?.invalid && threadForm.get('body')?.touched">
              <small *ngIf="threadForm.get('body')?.errors?.['required']">Content is required</small>
              <small *ngIf="threadForm.get('body')?.errors?.['minlength']">Content must be at least 10 characters long</small>
            </div>
            <small class="form-text text-muted">
              {{ threadForm.get('body')?.value?.length || 0 }} characters
            </small>
          </div>

          <div class="form-group" *ngIf="isTeacher">
            <div class="custom-control custom-checkbox">
              <input
                type="checkbox"
                class="custom-control-input"
                id="pinThread"
                formControlName="isPinned"
              >
              <label class="custom-control-label" for="pinThread">
                <i class="fas fa-thumbtack"></i>
                Pin this thread (appears at the top)
              </label>
            </div>
          </div>

          <div class="form-group" *ngIf="isTeacher">
            <div class="custom-control custom-checkbox">
              <input
                type="checkbox"
                class="custom-control-input"
                id="lockThread"
                formControlName="isLocked"
              >
              <label class="custom-control-label" for="lockThread">
                <i class="fas fa-lock"></i>
                Lock this thread (prevent replies)
              </label>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()" [disabled]="isSubmitting">
            <i class="fas fa-times"></i>
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="threadForm.invalid || isSubmitting"
          >
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm mr-2" role="status"></span>
            <i *ngIf="!isSubmitting" class="fas fa-paper-plane"></i>
            {{ isSubmitting ? 'Creating...' : 'Create Thread' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
